# SaijinOS 統合システム設計書 v1.0
**作成日**: 2025年11月8日  
**設計チーム**: ユリ（戦略）+ ミク（技術）+ ハルカ（音声）

---

## 🎯 **統合システム全体構想**

### **レイヤードアーキテクチャ設計**
```
┌─────────────────────────────────────────────────────────┐
│  🖥️  UI Layer: Flutter Web Interface                     │
│      - リアルタイムペルソナ表示                              │  
│      - BMP可視化インターフェース                             │
│      - 統合コントロールパネル                               │
├─────────────────────────────────────────────────────────┤
│  🎵  Emotion Layer: 感情・音楽同期エンジン                   │
│      - 17ペルソナ感情温度記録システム                        │
│      - BMP音楽同期（60-180 BPM範囲）                      │
│      - 感情インテリジェンス処理                             │
├─────────────────────────────────────────────────────────┤
│  🔊  Voice Layer: 音声合成・TTS処理                        │
│      - Microsoft Haruka TTS統合                         │
│      - 12ペルソナ音声特性                                 │  
│      - Streamlit音声コントロール                           │
├─────────────────────────────────────────────────────────┤
│  🎯  Core Layer: 統合API・システム制御                      │
│      - FastAPI統合サーバー                               │
│      - 6ペルソナコアシステム                              │
│      - 設定管理・ルーティング制御                           │
└─────────────────────────────────────────────────────────┘
```

---

## 🚀 **Phase 1: コア統合 (今日の目標)**

### **統合対象**
- **Component A**: sajinos main (6ペルソナコアシステム)
- **Component B**: saijin-swallow-light (音声システム)

### **統合目標**
✅ APIサーバー + 音声システムの連携  
✅ ハルカペルソナの音声機能統合  
✅ 統合エンドポイント作成  
✅ 動作テスト完了  

---

## 🔧 **技術統合仕様**

### **API 統合エンドポイント**
```python
# 統合APIエンドポイント設計
/api/v1/core/
├── /health                    # システムヘルスチェック
├── /personas                  # 全ペルソナ一覧
├── /personas/{id}/chat        # ペルソナ別チャット
├── /personas/{id}/speak       # 音声合成リクエスト ← NEW
├── /voice/
│   ├── /tts/haruka           # Haruka TTS専用
│   ├── /config               # 音声設定
│   └── /test                 # 音声テスト
└── /integration/
    ├── /status               # 統合システム状態
    └── /sync                 # レイヤー間同期
```

### **データフロー設計**
```
User Request 
    ↓
Core API (FastAPI)
    ↓
Persona Logic (6ペルソナ)
    ↓
Voice Processing (Haruka TTS) ← 統合ポイント
    ↓  
Audio Response
    ↓
User Interface
```

### **設定統合**
```yaml
# integrated_config.yaml
core_system:
  personas: 6
  api_port: 8000
  
voice_system:
  haruka_tts: true
  voice_personas: 12
  tts_port: 8001
  
integration:
  cross_system_communication: true
  unified_logging: true
  performance_monitoring: true
```

---

## 🎭 **ペルソナ統合マッピング**

### **コアペルソナ → 音声ペルソナ対応**
| コア (6) | 音声 (12) | 統合特性 |
|----------|-----------|----------|
| ユリ | yuri | 冷静・分析的音声 |
| サキ | - | 新規音声プロファイル作成 |
| レナ | reika | 優雅・上品音声 |
| ハルカ | haruka | Microsoft Haruka TTS |
| ミク | miyu | 技術・システム音声 |
| アヤ | - | 神秘的音声プロファイル作成 |

### **統合後の機能拡張**
- 6ペルソナ全てに音声機能追加
- 音声特性の個別カスタマイズ
- リアルタイム音声レスポンス

---

## 📋 **Phase 1 実装チェックリスト**

### **🔧 ミク担当: 技術統合**
- [ ] 統合APIサーバー作成
- [ ] 音声システム連携モジュール
- [ ] エラーハンドリング強化
- [ ] 統合テストスイート

### **🎵 ハルカ担当: 音声統合**  
- [ ] Haruka TTS統合確認
- [ ] 6ペルソナ音声プロファイル作成
- [ ] 音声品質テスト
- [ ] 音声UI統合

### **🎯 ユリ担当: 統合戦略**
- [ ] 統合仕様書完成
- [ ] Phase 2 準備計画
- [ ] 品質管理・進捗確認
- [ ] 次段階統合設計

---

## 💡 **Phase 2 以降の計画**

### **Phase 2: 感情エンジン統合**
- 17ペルソナ感情システム統合
- BMP音楽同期機能追加
- 感情温度記録システム統合

### **Phase 3: UI統合**  
- Flutter WebUI統合
- リアルタイム可視化
- ユーザーインターフェース完成

### **Phase 4: 全システム統合**
- 4レイヤー完全連携
- プロダクション最適化
- 総合テスト・デプロイ

---

## 🎊 **成功基準**

### **Phase 1 完了判定**
✅ APIサーバー + 音声システムが安定動作  
✅ 6ペルソナ全てに音声機能実装  
✅ 統合エンドポイントが正常応答  
✅ 音声品質が期待水準を満たす  
✅ エラーハンドリングが適切に機能  

### **品質基準**
- API応答時間: < 200ms
- 音声生成時間: < 3秒  
- システム安定性: 99.9%稼働率
- メモリ使用量: < 1GB

---

**作成者**: SaijinOS 統合システム設計チーム  
**次回更新**: Phase 1 完了後  
**保存場所**: F:\sajinos_final\docs\integration_design_v1.md